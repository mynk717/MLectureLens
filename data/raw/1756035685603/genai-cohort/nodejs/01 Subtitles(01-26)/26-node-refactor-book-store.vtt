WEBVTT

1
00:00:00.160 --> 00:00:01.600
Okay, so now that you have

2
00:00:01.600 --> 00:00:03.640
knowledge about modules and how

3
00:00:03.640 --> 00:00:04.960
you can create your own custom

4
00:00:04.960 --> 00:00:07.520
modules in Node js, let's start

5
00:00:07.520 --> 00:00:10.000
with refactoring our code and move

6
00:00:10.000 --> 00:00:12.640
the things, the related content to

7
00:00:12.640 --> 00:00:14.640
appropriate, you know, what do you

8
00:00:14.640 --> 00:00:15.200
call modules?

9
00:00:15.200 --> 00:00:17.120
Okay, so what I have to do is this is

10
00:00:17.120 --> 00:00:18.560
the code right now and you can see

11
00:00:18.560 --> 00:00:20.000
that what is the state of this code.

12
00:00:20.000 --> 00:00:21.040
So what I'm going to do is first

13
00:00:21.040 --> 00:00:22.760
of all let's create a module

14
00:00:22.760 --> 00:00:24.480
or a folder that is routes.

15
00:00:24.480 --> 00:00:25.600
So it's a good practice

16
00:00:25.600 --> 00:00:28.040
to get all your, all your

17
00:00:28.040 --> 00:00:29.810
routes into this folder.

18
00:00:29.810 --> 00:00:31.410
So you can see that these all routes

19
00:00:31.410 --> 00:00:33.930
actually contains or actually you

20
00:00:33.930 --> 00:00:36.410
know, they match to the books route.

21
00:00:36.410 --> 00:00:37.010
Right.

22
00:00:37.010 --> 00:00:38.210
So what happens when you

23
00:00:38.210 --> 00:00:39.250
are in a real world?

24
00:00:39.250 --> 00:00:40.290
There are a lot of routes.

25
00:00:40.290 --> 00:00:41.970
Like for example, routes for books,

26
00:00:41.970 --> 00:00:43.330
routes for authors, routes for

27
00:00:43.330 --> 00:00:45.090
pricing, routes for checking out.

28
00:00:45.090 --> 00:00:46.250
So you can see that right

29
00:00:46.250 --> 00:00:48.050
now all the routes are actually

30
00:00:48.050 --> 00:00:49.490
related to a book.

31
00:00:49.490 --> 00:00:50.650
So what I can do is I can

32
00:00:50.650 --> 00:00:51.810
actually create a file that is

33
00:00:51.810 --> 00:00:56.800
book.routs ts or sorry js.

34
00:00:56.800 --> 00:00:58.240
So I'm actually used

35
00:00:58.240 --> 00:00:59.760
to the typescript world.

36
00:00:59.760 --> 00:01:02.160
So yeah, so book routes js.

37
00:01:02.160 --> 00:01:03.880
So here what we can do is we can

38
00:01:03.880 --> 00:01:06.880
actually move all our book created

39
00:01:06.880 --> 00:01:08.880
routes in this particular file.

40
00:01:08.880 --> 00:01:10.080
So for that what we have

41
00:01:10.080 --> 00:01:10.880
to do is first of all

42
00:01:10.880 --> 00:01:12.320
let's import the express.

43
00:01:12.320 --> 00:01:12.960
Okay?

44
00:01:12.960 --> 00:01:15.000
And then express gives you

45
00:01:15.000 --> 00:01:16.600
a functionality for a router.

46
00:01:16.600 --> 00:01:17.720
So you can create a router

47
00:01:17.720 --> 00:01:19.280
using Express router.

48
00:01:19.840 --> 00:01:21.920
So what this will do is this router,

49
00:01:21.920 --> 00:01:23.600
you have created a router here

50
00:01:23.600 --> 00:01:25.200
and now what you can do is

51
00:01:25.200 --> 00:01:26.240
you can create routes here.

52
00:01:26.240 --> 00:01:27.180
Okay, for example,

53
00:01:27.180 --> 00:01:28.140
example, let me show you.

54
00:01:28.140 --> 00:01:29.380
Let's do it one by one.

55
00:01:29.380 --> 00:01:30.500
So what I can do is first

56
00:01:30.500 --> 00:01:32.060
of all I want to move this route.

57
00:01:32.060 --> 00:01:34.060
Okay, so cut it from here

58
00:01:34.060 --> 00:01:35.420
and paste it here.

59
00:01:35.420 --> 00:01:38.300
And now you have to use router get.

60
00:01:38.300 --> 00:01:40.140
Okay, that is Flashbox.

61
00:01:40.140 --> 00:01:41.900
Great, you have moved one.

62
00:01:41.900 --> 00:01:43.620
Then let's also move this one.

63
00:01:43.620 --> 00:01:45.060
That is router.

64
00:01:45.060 --> 00:01:46.340
Now we don't have app, we

65
00:01:46.340 --> 00:01:47.300
have to use this router.

66
00:01:47.300 --> 00:01:48.730
Okay, so this is a separate router.

67
00:01:49.340 --> 00:01:51.700
Then let's also move this one.

68
00:01:51.700 --> 00:01:53.020
Okay, so I'll just

69
00:01:53.020 --> 00:01:54.060
move this one also.

70
00:01:54.060 --> 00:01:54.820
So you can see that

71
00:01:54.820 --> 00:01:55.700
this is also moved.

72
00:01:55.700 --> 00:01:56.820
And then we can also

73
00:01:56.820 --> 00:01:58.310
name it as router.

74
00:01:58.310 --> 00:01:59.950
Okay, so router.post

75
00:01:59.950 --> 00:02:01.030
route is also moved.

76
00:02:01.030 --> 00:02:02.430
And let's also finally

77
00:02:02.430 --> 00:02:03.430
move the delete one.

78
00:02:03.430 --> 00:02:06.470
Okay, so now all the routers,

79
00:02:06.470 --> 00:02:07.990
all the routes are moved.

80
00:02:07.990 --> 00:02:09.509
Now what you have to do is

81
00:02:09.509 --> 00:02:11.510
this router, is basically

82
00:02:11.510 --> 00:02:13.190
handling all the books route.

83
00:02:13.190 --> 00:02:15.110
Let's do a default export.

84
00:02:15.110 --> 00:02:16.950
So default export of this router,

85
00:02:16.950 --> 00:02:18.790
okay, so this router is now

86
00:02:18.790 --> 00:02:20.270
default exported from here.

87
00:02:20.270 --> 00:02:21.910
So see what we, what you did, you

88
00:02:21.910 --> 00:02:24.030
created a new router, you added

89
00:02:24.030 --> 00:02:25.230
all the routes to it and you

90
00:02:25.230 --> 00:02:27.310
exported this router from here in

91
00:02:27.310 --> 00:02:29.790
the index js, which is almost empty.

92
00:02:29.790 --> 00:02:31.710
Now what I can do is I can

93
00:02:31.710 --> 00:02:33.070
just say first of all

94
00:02:33.070 --> 00:02:34.390
let's import that, right?

95
00:02:34.390 --> 00:02:36.390
I want to import my custom

96
00:02:36.390 --> 00:02:37.790
module or custom router.

97
00:02:37.790 --> 00:02:39.350
So that is my book router.

98
00:02:39.350 --> 00:02:40.310
So let's call it as book

99
00:02:40.310 --> 00:02:42.310
router equals require.

100
00:02:42.950 --> 00:02:44.510
And what I can say, I can just

101
00:02:44.510 --> 00:02:47.510
say dot slash routes book.

102
00:02:47.510 --> 00:02:49.950
So this book router basically is

103
00:02:49.950 --> 00:02:51.630
a reference to that router, right?

104
00:02:51.630 --> 00:02:53.070
So if I click on here, so you

105
00:02:53.070 --> 00:02:54.030
will actually be coming

106
00:02:54.030 --> 00:02:55.230
to here because this is what

107
00:02:55.230 --> 00:02:56.710
you are exporting from here.

108
00:02:57.410 --> 00:02:59.010
Now this book router can be used

109
00:02:59.010 --> 00:03:01.570
how I can just say app dot use.

110
00:03:02.210 --> 00:03:02.730
Okay.

111
00:03:02.730 --> 00:03:04.250
And I can say for all the routes

112
00:03:04.250 --> 00:03:05.730
use this book router.

113
00:03:05.730 --> 00:03:06.930
So yeah, that's it.

114
00:03:06.930 --> 00:03:07.970
So what you have done is you

115
00:03:07.970 --> 00:03:09.450
have moved all the book related

116
00:03:09.450 --> 00:03:11.250
stuff to this book router.

117
00:03:11.250 --> 00:03:12.650
Now there are a couple of more

118
00:03:12.650 --> 00:03:13.970
changes that we have to do.

119
00:03:13.970 --> 00:03:16.010
Do you see that this slash books

120
00:03:16.010 --> 00:03:17.410
is common, do you see the slash

121
00:03:17.410 --> 00:03:18.770
books is common in everyone.

122
00:03:19.330 --> 00:03:21.250
So what you can do is just remove it.

123
00:03:21.250 --> 00:03:22.650
Just remove the slash books

124
00:03:22.650 --> 00:03:24.210
at the beginning from everywhere.

125
00:03:24.210 --> 00:03:26.250
Okay, so you can see that I have

126
00:03:26.250 --> 00:03:27.850
removed everything from here.

127
00:03:27.850 --> 00:03:28.410
Nice.

128
00:03:28.410 --> 00:03:29.570
Now what you can do is you

129
00:03:29.570 --> 00:03:30.650
can actually put just

130
00:03:30.650 --> 00:03:32.330
once, that is slash books.

131
00:03:32.330 --> 00:03:34.090
So this will tell the express

132
00:03:34.090 --> 00:03:36.090
that hey, if there is any

133
00:03:36.090 --> 00:03:38.890
route that starts with slash books

134
00:03:38.890 --> 00:03:40.890
move delegate that

135
00:03:40.890 --> 00:03:42.650
request to this book router.

136
00:03:42.650 --> 00:03:45.210
So books get route will match here.

137
00:03:45.210 --> 00:03:47.130
Books ID will match here.

138
00:03:47.130 --> 00:03:48.530
Slash books post request

139
00:03:48.530 --> 00:03:49.010
will match here.

140
00:03:49.010 --> 00:03:51.450
And/books id delete will match here.

141
00:03:52.010 --> 00:03:52.650
Nice.

142
00:03:52.650 --> 00:03:53.890
So this you have moved.

143
00:03:53.890 --> 00:03:54.970
Very good.

144
00:03:54.970 --> 00:03:56.380
Now one thing.

145
00:03:56.380 --> 00:03:57.860
Do you remember that we had

146
00:03:57.860 --> 00:03:59.860
this memory, this, this db.

147
00:03:59.860 --> 00:04:01.540
Now this DB is here and we are

148
00:04:01.540 --> 00:04:03.380
not no longer able to access it.

149
00:04:03.380 --> 00:04:05.500
So for that what we can do is I can

150
00:04:05.500 --> 00:04:07.220
actually create a folder for db.

151
00:04:07.220 --> 00:04:09.140
I mean in reality it will be

152
00:04:09.140 --> 00:04:10.780
like a real db but right

153
00:04:10.780 --> 00:04:11.859
now we don't have that.

154
00:04:11.859 --> 00:04:14.260
So let's call it as book js.

155
00:04:14.260 --> 00:04:16.260
And what I can do is I can just cut

156
00:04:16.260 --> 00:04:18.339
it from here and paste it here.

157
00:04:18.339 --> 00:04:22.430
And I can just say exports.

158
00:04:22.430 --> 00:04:23.990
Let's call it as like books

159
00:04:23.990 --> 00:04:25.870
equals just an array.

160
00:04:25.870 --> 00:04:27.390
So I'm doing a named export

161
00:04:27.390 --> 00:04:28.870
here of a books variable

162
00:04:28.870 --> 00:04:30.270
which is my actual db.

163
00:04:30.830 --> 00:04:33.030
Now inside your router what you

164
00:04:33.030 --> 00:04:34.590
can do is let's import that.

165
00:04:34.590 --> 00:04:36.030
Right, let's import that.

166
00:04:36.030 --> 00:04:37.350
So this is a named export

167
00:04:37.350 --> 00:04:38.830
so dot, dot, slash, go

168
00:04:38.830 --> 00:04:40.590
one folder up and book.

169
00:04:40.590 --> 00:04:42.350
And here you got the books.

170
00:04:42.350 --> 00:04:43.630
Now what you can do all

171
00:04:43.630 --> 00:04:44.590
the operations you have

172
00:04:44.590 --> 00:04:45.950
to do on this books, right?

173
00:04:45.950 --> 00:04:46.910
So this is one place

174
00:04:46.910 --> 00:04:47.870
where we have to change.

175
00:04:47.870 --> 00:04:49.470
Then this is where we have to change.

176
00:04:49.470 --> 00:04:51.150
Then books, push then.

177
00:04:51.150 --> 00:04:52.230
Then you have to change it here,

178
00:04:52.230 --> 00:04:53.510
then you have to change it here.

179
00:04:53.510 --> 00:04:54.830
And yeah, that's it.

180
00:04:54.830 --> 00:04:56.110
So all the changes are done.

181
00:04:56.110 --> 00:04:57.070
And yeah, one more thing.

182
00:04:57.070 --> 00:04:57.630
Books.

183
00:04:57.630 --> 00:04:58.110
Cool.

184
00:04:58.670 --> 00:05:00.590
Okay, let's come back to the index.

185
00:05:00.590 --> 00:05:01.990
Now the middlewares, right?

186
00:05:01.990 --> 00:05:03.190
Let's remove this middleware.

187
00:05:03.190 --> 00:05:04.550
This was just a custom middleware,

188
00:05:04.550 --> 00:05:06.190
so no need to worry about that.

189
00:05:06.190 --> 00:05:07.590
So you can see that we have a logger

190
00:05:07.590 --> 00:05:09.070
middleware which we are using here.

191
00:05:09.070 --> 00:05:10.910
Now this middlewares can also be

192
00:05:10.910 --> 00:05:12.910
moved to a separate file, right?

193
00:05:12.910 --> 00:05:14.510
Middlewares.

194
00:05:14.510 --> 00:05:15.150
Okay.

195
00:05:15.150 --> 00:05:16.390
So I can create a middleware

196
00:05:16.390 --> 00:05:17.550
for let's say logging purpose.

197
00:05:17.550 --> 00:05:19.630
So logger, js.

198
00:05:20.230 --> 00:05:21.870
So what I can do, I can just take

199
00:05:21.870 --> 00:05:23.390
up this middleware, cut it from

200
00:05:23.390 --> 00:05:25.550
here, extract the logic here and

201
00:05:25.550 --> 00:05:28.430
do a exports dot and just say

202
00:05:28.430 --> 00:05:30.950
that exports logger middleware is

203
00:05:30.950 --> 00:05:32.630
actually equals to a function,

204
00:05:32.630 --> 00:05:32.950
right?

205
00:05:32.950 --> 00:05:34.230
And that's it.

206
00:05:34.230 --> 00:05:35.510
So now what we can do is because

207
00:05:35.510 --> 00:05:37.470
this is exported from here, we have

208
00:05:37.470 --> 00:05:39.110
to import this logger middleware.

209
00:05:39.110 --> 00:05:40.150
So how can I do that?

210
00:05:40.150 --> 00:05:42.270
I can just say all the middlewares

211
00:05:42.270 --> 00:05:43.270
I can import here.

212
00:05:43.270 --> 00:05:46.150
So const something equals require

213
00:05:46.150 --> 00:05:48.810
to dot, slash, middleware logger.

214
00:05:48.810 --> 00:05:50.410
So let's call it as log.

215
00:05:51.210 --> 00:05:52.930
There is there is one named export

216
00:05:52.930 --> 00:05:53.970
that is logger middleware.

217
00:05:53.970 --> 00:05:55.930
So yeah, this is also done nice

218
00:05:55.930 --> 00:05:57.290
routes middlewares.

219
00:05:57.290 --> 00:05:59.690
This FS module is no longer

220
00:05:59.690 --> 00:06:00.850
not, required here.

221
00:06:00.850 --> 00:06:01.810
It is actually required

222
00:06:01.810 --> 00:06:02.529
in the middleware.

223
00:06:02.529 --> 00:06:03.250
Right, because this is

224
00:06:03.250 --> 00:06:04.570
where we are using the fs.

225
00:06:04.570 --> 00:06:05.450
So yeah, don't forget

226
00:06:05.450 --> 00:06:06.970
to import the FS here.

227
00:06:06.970 --> 00:06:07.530
So const.

228
00:06:08.490 --> 00:06:12.640
Const FS equals require the node fs.

229
00:06:12.640 --> 00:06:12.800
Right.

230
00:06:12.800 --> 00:06:13.800
So this FS is actually

231
00:06:13.800 --> 00:06:15.040
getting used here.

232
00:06:15.600 --> 00:06:16.600
So this is also done.

233
00:06:16.600 --> 00:06:17.640
Okay, I hope there is

234
00:06:17.640 --> 00:06:18.800
nothing that we have left.

235
00:06:18.800 --> 00:06:20.760
And let's go back to the index js.

236
00:06:20.760 --> 00:06:22.120
So you have this thing, you have this

237
00:06:22.120 --> 00:06:23.360
thing, you have this thing and.

238
00:06:23.360 --> 00:06:24.040
Very cool.

239
00:06:24.040 --> 00:06:24.480
Right.

240
00:06:24.480 --> 00:06:25.560
So now you can see that our

241
00:06:25.560 --> 00:06:26.560
code is actually splitted

242
00:06:26.560 --> 00:06:27.600
into the multiple files.

243
00:06:27.600 --> 00:06:28.719
Let me give you a walkthrough.

244
00:06:28.719 --> 00:06:30.080
Let me just delete this file also.

245
00:06:30.640 --> 00:06:32.160
First, your index js.

246
00:06:32.160 --> 00:06:33.840
This is your main file, your entry

247
00:06:33.840 --> 00:06:35.760
point where everything will start.

248
00:06:35.760 --> 00:06:36.640
So this will actually

249
00:06:36.640 --> 00:06:37.760
do an initialization.

250
00:06:37.760 --> 00:06:39.160
So you have an app.

251
00:06:39.160 --> 00:06:40.880
You are registering your middlewares,

252
00:06:40.880 --> 00:06:42.520
you are registering your routes.

253
00:06:42.520 --> 00:06:43.880
Any route that matches

254
00:06:43.880 --> 00:06:45.640
books will go into this book router.

255
00:06:45.640 --> 00:06:46.040
Right.

256
00:06:46.040 --> 00:06:47.680
So this book router is basically

257
00:06:47.680 --> 00:06:49.880
coming from this routes file.

258
00:06:49.880 --> 00:06:51.160
That is book routes,

259
00:06:51.160 --> 00:06:52.920
this routes, these all things

260
00:06:52.920 --> 00:06:54.240
actually contains routes.

261
00:06:54.240 --> 00:06:55.480
That is for the books.

262
00:06:55.480 --> 00:06:56.360
Correct.

263
00:06:56.360 --> 00:06:57.600
So now you can see that you have

264
00:06:57.600 --> 00:06:59.080
a get route, you have a post route.

265
00:06:59.080 --> 00:07:01.160
So all the routes, are given here.

266
00:07:01.160 --> 00:07:02.760
Now one thing that you can do is you

267
00:07:02.760 --> 00:07:04.640
can even extract out this logic.

268
00:07:04.640 --> 00:07:05.120
Do you see?

269
00:07:05.120 --> 00:07:06.800
This logic can be also extracted

270
00:07:06.800 --> 00:07:07.600
to a different thing that

271
00:07:07.600 --> 00:07:09.020
is known as a controller.

272
00:07:09.020 --> 00:07:09.740
Okay.

273
00:07:09.740 --> 00:07:11.500
So you can define a controller.

274
00:07:11.500 --> 00:07:12.300
So we'll talk about

275
00:07:12.300 --> 00:07:13.860
the MVC architecture model

276
00:07:13.860 --> 00:07:14.780
view controller there.

277
00:07:14.780 --> 00:07:15.900
You will understand this thing.

278
00:07:15.900 --> 00:07:17.740
But right now this part is fine.

279
00:07:17.740 --> 00:07:19.260
Let's test our implementation.

280
00:07:19.260 --> 00:07:20.700
So npm start.

281
00:07:20.700 --> 00:07:22.180
So if I go into the Thunder

282
00:07:22.180 --> 00:07:22.980
client, let's see if

283
00:07:22.980 --> 00:07:24.020
everything is working fine.

284
00:07:24.020 --> 00:07:24.540
Right?

285
00:07:24.540 --> 00:07:26.700
So if I try to get the all the books.

286
00:07:26.700 --> 00:07:27.900
Yeah, you can see we are

287
00:07:27.900 --> 00:07:29.580
getting all the books, right?

288
00:07:29.580 --> 00:07:30.220
Cool.

289
00:07:30.220 --> 00:07:31.900
Let's try to create a book.

290
00:07:31.900 --> 00:07:33.340
Yeah, book creation is a success.

291
00:07:33.340 --> 00:07:34.740
Let's try to get the book.

292
00:07:34.740 --> 00:07:35.420
So you can see that now

293
00:07:35.420 --> 00:07:36.580
I have three books.

294
00:07:36.580 --> 00:07:38.900
Let's try to get the book three.

295
00:07:38.900 --> 00:07:41.300
So I'm getting the book three only.

296
00:07:41.300 --> 00:07:42.220
Let's try to delete

297
00:07:42.220 --> 00:07:43.540
the book number two.

298
00:07:43.540 --> 00:07:47.060
Okay, so book two, books slash two.

299
00:07:47.060 --> 00:07:48.260
Okay, we have to make

300
00:07:48.260 --> 00:07:48.980
a delete request.

301
00:07:48.980 --> 00:07:49.620
My bad.

302
00:07:49.620 --> 00:07:50.619
So delete request.

303
00:07:50.619 --> 00:07:51.460
Book is deleted.

304
00:07:51.460 --> 00:07:52.580
Let's now try to get it.

305
00:07:52.580 --> 00:07:53.740
We should get a 404.

306
00:07:53.740 --> 00:07:55.260
And if I try to get all

307
00:07:55.260 --> 00:07:56.780
the books right, you can see

308
00:07:56.780 --> 00:07:58.260
that book two is not there.

309
00:07:58.260 --> 00:07:59.220
Nice guys.

310
00:07:59.220 --> 00:08:00.900
You have actually successfully

311
00:08:00.900 --> 00:08:03.460
refactored your code in a very great

312
00:08:03.460 --> 00:08:05.380
way and congratulations.

313
00:08:05.380 --> 00:08:06.220
Now you know how to work

314
00:08:06.220 --> 00:08:07.160
with model modules and how

315
00:08:07.160 --> 00:08:08.640
to structure your code.

316
00:08:08.640 --> 00:08:10.280
Moving further, what we are going

317
00:08:10.280 --> 00:08:11.880
to do is we are actually going

318
00:08:11.880 --> 00:08:13.360
to write code in our different,

319
00:08:13.360 --> 00:08:14.760
different files so that it is

320
00:08:14.760 --> 00:08:15.920
easier to read, easier to

321
00:08:15.920 --> 00:08:17.520
maintain, and we follow the best

322
00:08:17.520 --> 00:08:18.080
practices.
